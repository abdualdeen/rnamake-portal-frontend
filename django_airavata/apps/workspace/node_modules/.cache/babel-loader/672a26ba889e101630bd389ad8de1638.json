{"remainingRequest":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/thread-loader/dist/cjs.js!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/babel-loader/lib/index.js!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/static/django_airavata_workspace/js/components/experiment/QueueSettingsEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/static/django_airavata_workspace/js/components/experiment/QueueSettingsEditor.vue","mtime":1638641844339},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1638646228487},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/thread-loader/dist/cjs.js","mtime":1638646228889},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/babel-loader/lib/index.js","mtime":1638646225600},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1638646228487},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/vue-loader/lib/index.js","mtime":1638646228900}],"contextDependencies":[],"result":["import \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.sort\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { models, services } from \"django-airavata-api\";\nimport { mixins, utils } from \"django-airavata-common-ui\";\nexport default {\n  name: \"queue-settings-editor\",\n  mixins: [mixins.VModelMixin],\n  props: {\n    value: {\n      type: models.ComputationalResourceSchedulingModel\n    },\n    appDeploymentId: {\n      type: String,\n      required: true\n    },\n    computeResourcePolicy: {\n      type: models.ComputeResourcePolicy,\n      required: false\n    },\n    batchQueueResourcePolicies: {\n      type: Array,\n      required: false\n    }\n  },\n  data: function data() {\n    return {\n      showConfiguration: false,\n      appDeploymentQueues: null\n    };\n  },\n  computed: {\n    queueOptions: function queueOptions() {\n      var queueOptions = this.queueDefaults.map(function (queueDefault) {\n        return {\n          value: queueDefault.queueName,\n          text: queueDefault.queueName\n        };\n      });\n      return queueOptions;\n    },\n    selectedQueueDefault: function selectedQueueDefault() {\n      var _this = this;\n\n      return this.queueDefaults.find(function (queue) {\n        return queue.queueName === _this.data.queueName;\n      });\n    },\n    maxCPUCount: function maxCPUCount() {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedCores, this.selectedQueueDefault.maxProcessors);\n      }\n\n      return this.selectedQueueDefault.maxProcessors;\n    },\n    maxNodes: function maxNodes() {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedNodes, this.selectedQueueDefault.maxNodes);\n      }\n\n      return this.selectedQueueDefault.maxNodes;\n    },\n    maxWalltime: function maxWalltime() {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedWalltime, this.selectedQueueDefault.maxRunTime);\n      }\n\n      return this.selectedQueueDefault.maxRunTime;\n    },\n    maxPhysicalMemory: function maxPhysicalMemory() {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n\n      return this.selectedQueueDefault.maxMemory;\n    },\n    queueDefaults: function queueDefaults() {\n      var _this2 = this;\n\n      return this.appDeploymentQueues ? this.appDeploymentQueues.filter(function (q) {\n        return _this2.isQueueInComputeResourcePolicy(q.queueName);\n      }).sort(function (a, b) {\n        // Sort default first, then by alphabetically by name\n        if (a.isDefaultQueue) {\n          return -1;\n        } else if (b.isDefaultQueue) {\n          return 1;\n        } else {\n          return a.queueName.localeCompare(b.queueName);\n        }\n      }) : [];\n    },\n    defaultQueue: function defaultQueue() {\n      if (this.queueDefaults.length === 0) {\n        return null;\n      }\n\n      return this.queueDefaults[0];\n    },\n    batchQueueResourcePolicy: function batchQueueResourcePolicy() {\n      if (!this.selectedQueueDefault) {\n        return null;\n      }\n\n      return this.getBatchQueueResourcePolicy(this.selectedQueueDefault.queueName);\n    },\n    queueDescription: function queueDescription() {\n      return this.selectedQueueDefault ? this.selectedQueueDefault.queueDescription : null;\n    },\n    validation: function validation() {\n      // Don't run validation if we don't have selectedQueueDefault\n      if (!this.selectedQueueDefault) {\n        return this.data.validate();\n      }\n\n      return this.data.validate(this.selectedQueueDefault, this.batchQueueResourcePolicy);\n    },\n    valid: function valid() {\n      return Object.keys(this.validation).length === 0;\n    }\n  },\n  methods: {\n    queueChanged: function queueChanged(queueName) {\n      var queueDefault = this.queueDefaults.find(function (queue) {\n        return queue.queueName === queueName;\n      });\n      this.data.totalCPUCount = this.getDefaultCPUCount(queueDefault);\n      this.data.nodeCount = this.getDefaultNodeCount(queueDefault);\n      this.data.wallTimeLimit = this.getDefaultWalltime(queueDefault);\n\n      if (this.maxPhysicalMemory === 0) {\n        this.data.totalPhysicalMemory = 0;\n      }\n    },\n    validate: function validate() {\n      if (!this.valid) {\n        this.$emit(\"invalid\");\n      } else {\n        this.$emit(\"valid\");\n      }\n    },\n    loadAppDeploymentQueues: function loadAppDeploymentQueues() {\n      var _this3 = this;\n\n      return services.ApplicationDeploymentService.getQueues({\n        lookup: this.appDeploymentId\n      }).then(function (queueDefaults) {\n        return _this3.appDeploymentQueues = queueDefaults;\n      });\n    },\n    setDefaultQueue: function setDefaultQueue() {\n      if (this.queueDefaults.length === 0) {\n        this.data.queueName = null;\n        return;\n      }\n\n      var defaultQueue = this.queueDefaults[0];\n      this.data.queueName = defaultQueue.queueName;\n      this.data.totalCPUCount = this.getDefaultCPUCount(defaultQueue);\n      this.data.nodeCount = this.getDefaultNodeCount(defaultQueue);\n      this.data.wallTimeLimit = this.getDefaultWalltime(defaultQueue);\n\n      if (this.maxPhysicalMemory === 0) {\n        this.data.totalPhysicalMemory = 0;\n      }\n    },\n    isQueueInComputeResourcePolicy: function isQueueInComputeResourcePolicy(queueName) {\n      if (!this.computeResourcePolicy) {\n        return true;\n      }\n\n      return this.computeResourcePolicy.allowedBatchQueues.includes(queueName);\n    },\n    getBatchQueueResourcePolicy: function getBatchQueueResourcePolicy(queueName) {\n      if (!this.batchQueueResourcePolicies || this.batchQueueResourcePolicies.length === 0) {\n        return null;\n      }\n\n      return this.batchQueueResourcePolicies.find(function (bqrp) {\n        return bqrp.queuename === queueName;\n      });\n    },\n    getDefaultCPUCount: function getDefaultCPUCount(queueDefault) {\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedCores, queueDefault.defaultCPUCount);\n      }\n\n      return queueDefault.defaultCPUCount;\n    },\n    getDefaultNodeCount: function getDefaultNodeCount(queueDefault) {\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedNodes, queueDefault.defaultNodeCount);\n      }\n\n      return queueDefault.defaultNodeCount;\n    },\n    getDefaultWalltime: function getDefaultWalltime(queueDefault) {\n      var batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n\n      if (batchQueueResourcePolicy) {\n        return Math.min(batchQueueResourcePolicy.maxAllowedWalltime, queueDefault.defaultWalltime);\n      }\n\n      return queueDefault.defaultWalltime;\n    },\n    getValidationFeedback: function getValidationFeedback(properties) {\n      return utils.getProperty(this.validation, properties);\n    },\n    getValidationState: function getValidationState(properties, showValidState) {\n      return this.getValidationFeedback(properties) ? \"invalid\" : showValidState ? \"valid\" : null;\n    },\n    applyBatchQueueResourcePolicy: function applyBatchQueueResourcePolicy() {\n      // Apply batchQueueResourcePolicy maximums\n      if (this.selectedQueueDefault) {\n        this.data.totalCPUCount = Math.min(this.data.totalCPUCount, this.maxCPUCount);\n        this.data.nodeCount = Math.min(this.data.nodeCount, this.maxNodes);\n        this.data.wallTimeLimit = Math.min(this.data.wallTimeLimit, this.maxWalltime);\n      }\n    }\n  },\n  watch: {\n    appDeploymentId: function appDeploymentId() {\n      var _this4 = this;\n\n      this.loadAppDeploymentQueues().then(function () {\n        return _this4.setDefaultQueue();\n      });\n    },\n    // If batch queue policy changes, apply any maximum values to current values\n    batchQueueResourcePolicy: function batchQueueResourcePolicy(value, oldValue) {\n      if (value && (!oldValue || value.resourcePolicyId !== oldValue.resourcePolicyId)) {\n        this.applyBatchQueueResourcePolicy();\n      }\n    },\n    computeResourcePolicy: function computeResourcePolicy() {\n      if (!this.isQueueInComputeResourcePolicy(this.data.queueName)) {\n        this.setDefaultQueue();\n      }\n    }\n  },\n  mounted: function mounted() {\n    var _this5 = this;\n\n    this.loadAppDeploymentQueues().then(function () {\n      // For brand new queue settings (no queueName specified) load the default\n      // queue and its default values and apply them\n      if (!_this5.value.queueName) {\n        _this5.setDefaultQueue();\n      }\n    });\n    this.$on(\"input\", function () {\n      return _this5.validate();\n    });\n  }\n};",{"version":3,"sources":["QueueSettingsEditor.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <div class=\"row\">\n      <div class=\"col\">\n        <div class=\"card border-default\" :class=\"{ 'border-danger': !valid }\">\n          <b-link\n            @click=\"showConfiguration = !showConfiguration\"\n            class=\"card-link text-dark\"\n          >\n            <div class=\"card-body\">\n              <h5 class=\"card-title mb-4\">\n                Settings for queue {{ data.queueName }}\n              </h5>\n              <div class=\"row\">\n                <div class=\"col\">\n                  <h3 class=\"h5 mb-0\">\n                    {{ data.nodeCount }}\n                  </h3>\n                  <span class=\"text-muted text-uppercase\">NODE COUNT</span>\n                </div>\n                <div class=\"col\">\n                  <h3 class=\"h5 mb-0\">\n                    {{ data.totalCPUCount }}\n                  </h3>\n                  <span class=\"text-muted text-uppercase\">CORE COUNT</span>\n                </div>\n                <div class=\"col\">\n                  <h3 class=\"h5 mb-0\">{{ data.wallTimeLimit }} minutes</h3>\n                  <span class=\"text-muted text-uppercase\">TIME LIMIT</span>\n                </div>\n                <div class=\"col\" v-if=\"maxPhysicalMemory > 0\">\n                  <h3 class=\"h5 mb-0\">{{ data.totalPhysicalMemory }} MB</h3>\n                  <span class=\"text-muted text-uppercase\">PHYSICAL MEMORY</span>\n                </div>\n              </div>\n            </div>\n          </b-link>\n        </div>\n      </div>\n    </div>\n    <div v-if=\"showConfiguration\">\n      <div class=\"row\">\n        <div class=\"col\">\n          <b-form-group\n            label=\"Select a Queue\"\n            label-for=\"queue\"\n            :invalid-feedback=\"getValidationFeedback('queueName')\"\n            :state=\"getValidationState('queueName')\"\n          >\n            <b-form-select\n              id=\"queue\"\n              v-model=\"data.queueName\"\n              :options=\"queueOptions\"\n              required\n              @change=\"queueChanged\"\n              :state=\"getValidationState('queueName')\"\n            >\n            </b-form-select>\n            <div slot=\"description\">\n              {{ queueDescription }}\n            </div>\n          </b-form-group>\n          <b-form-group\n            label=\"Node Count\"\n            label-for=\"node-count\"\n            :invalid-feedback=\"getValidationFeedback('nodeCount')\"\n            :state=\"getValidationState('nodeCount', true)\"\n          >\n            <b-form-input\n              id=\"node-count\"\n              type=\"number\"\n              min=\"1\"\n              :max=\"maxNodes\"\n              v-model=\"data.nodeCount\"\n              required\n              :state=\"getValidationState('nodeCount', true)\"\n            >\n            </b-form-input>\n            <div slot=\"description\">\n              <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\n              Max Allowed Nodes = {{ maxNodes }}\n            </div>\n          </b-form-group>\n          <b-form-group\n            label=\"Total Core Count\"\n            label-for=\"core-count\"\n            :invalid-feedback=\"getValidationFeedback('totalCPUCount')\"\n            :state=\"getValidationState('totalCPUCount', true)\"\n          >\n            <b-form-input\n              id=\"core-count\"\n              type=\"number\"\n              min=\"1\"\n              :max=\"maxCPUCount\"\n              v-model=\"data.totalCPUCount\"\n              required\n              :state=\"getValidationState('totalCPUCount', true)\"\n            >\n            </b-form-input>\n            <div slot=\"description\">\n              <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\n              Max Allowed Cores = {{ maxCPUCount }}\n            </div>\n          </b-form-group>\n          <b-form-group\n            label=\"Wall Time Limit\"\n            label-for=\"walltime-limit\"\n            :invalid-feedback=\"getValidationFeedback('wallTimeLimit')\"\n            :state=\"getValidationState('wallTimeLimit', true)\"\n          >\n            <b-input-group append=\"minutes\">\n              <b-form-input\n                id=\"walltime-limit\"\n                type=\"number\"\n                min=\"1\"\n                :max=\"maxWalltime\"\n                v-model=\"data.wallTimeLimit\"\n                required\n                :state=\"getValidationState('wallTimeLimit', true)\"\n              >\n              </b-form-input>\n            </b-input-group>\n            <div slot=\"description\">\n              <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\n              Max Allowed Wall Time = {{ maxWalltime }} minutes\n            </div>\n          </b-form-group>\n          <b-form-group\n            v-if=\"maxPhysicalMemory > 0\"\n            label=\"Total Physical Memory\"\n            label-for=\"total-physical-memory\"\n            :invalid-feedback=\"getValidationFeedback('totalPhysicalMemory')\"\n            :state=\"getValidationState('totalPhysicalMemory', true)\"\n          >\n            <b-input-group append=\"MB\">\n              <b-form-input\n                id=\"total-physical-memory\"\n                type=\"number\"\n                min=\"0\"\n                :max=\"maxPhysicalMemory\"\n                v-model=\"data.totalPhysicalMemory\"\n                :state=\"getValidationState('totalPhysicalMemory', true)\"\n              >\n              </b-form-input>\n            </b-input-group>\n            <div slot=\"description\">\n              <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i>\n              Max Physical Memory = {{ maxPhysicalMemory }} MB\n            </div>\n          </b-form-group>\n          <div>\n            <a\n              class=\"text-secondary action-link\"\n              href=\"#\"\n              @click.prevent=\"showConfiguration = false\"\n            >\n              <i class=\"fa fa-times text-secondary\" aria-hidden=\"true\"></i>\n              Hide Settings</a\n            >\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { models, services } from \"django-airavata-api\";\nimport { mixins, utils } from \"django-airavata-common-ui\";\n\nexport default {\n  name: \"queue-settings-editor\",\n  mixins: [mixins.VModelMixin],\n  props: {\n    value: {\n      type: models.ComputationalResourceSchedulingModel,\n    },\n    appDeploymentId: {\n      type: String,\n      required: true,\n    },\n    computeResourcePolicy: {\n      type: models.ComputeResourcePolicy,\n      required: false,\n    },\n    batchQueueResourcePolicies: {\n      type: Array,\n      required: false,\n    },\n  },\n  data() {\n    return {\n      showConfiguration: false,\n      appDeploymentQueues: null,\n    };\n  },\n  computed: {\n    queueOptions: function () {\n      const queueOptions = this.queueDefaults.map((queueDefault) => {\n        return {\n          value: queueDefault.queueName,\n          text: queueDefault.queueName,\n        };\n      });\n      return queueOptions;\n    },\n    selectedQueueDefault: function () {\n      return this.queueDefaults.find(\n        (queue) => queue.queueName === this.data.queueName\n      );\n    },\n    maxCPUCount: function () {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedCores,\n          this.selectedQueueDefault.maxProcessors\n        );\n      }\n      return this.selectedQueueDefault.maxProcessors;\n    },\n    maxNodes: function () {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedNodes,\n          this.selectedQueueDefault.maxNodes\n        );\n      }\n      return this.selectedQueueDefault.maxNodes;\n    },\n    maxWalltime: function () {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedWalltime,\n          this.selectedQueueDefault.maxRunTime\n        );\n      }\n      return this.selectedQueueDefault.maxRunTime;\n    },\n    maxPhysicalMemory: function () {\n      if (!this.selectedQueueDefault) {\n        return 0;\n      }\n      return this.selectedQueueDefault.maxMemory;\n    },\n    queueDefaults() {\n      return this.appDeploymentQueues\n        ? this.appDeploymentQueues\n            .filter((q) => this.isQueueInComputeResourcePolicy(q.queueName))\n            .sort((a, b) => {\n              // Sort default first, then by alphabetically by name\n              if (a.isDefaultQueue) {\n                return -1;\n              } else if (b.isDefaultQueue) {\n                return 1;\n              } else {\n                return a.queueName.localeCompare(b.queueName);\n              }\n            })\n        : [];\n    },\n    defaultQueue() {\n      if (this.queueDefaults.length === 0) {\n        return null;\n      }\n      return this.queueDefaults[0];\n    },\n    batchQueueResourcePolicy() {\n      if (!this.selectedQueueDefault) {\n        return null;\n      }\n      return this.getBatchQueueResourcePolicy(\n        this.selectedQueueDefault.queueName\n      );\n    },\n    queueDescription() {\n      return this.selectedQueueDefault\n        ? this.selectedQueueDefault.queueDescription\n        : null;\n    },\n    validation() {\n      // Don't run validation if we don't have selectedQueueDefault\n      if (!this.selectedQueueDefault) {\n        return this.data.validate();\n      }\n      return this.data.validate(\n        this.selectedQueueDefault,\n        this.batchQueueResourcePolicy\n      );\n    },\n    valid() {\n      return Object.keys(this.validation).length === 0;\n    },\n  },\n  methods: {\n    queueChanged: function (queueName) {\n      const queueDefault = this.queueDefaults.find(\n        (queue) => queue.queueName === queueName\n      );\n      this.data.totalCPUCount = this.getDefaultCPUCount(queueDefault);\n      this.data.nodeCount = this.getDefaultNodeCount(queueDefault);\n      this.data.wallTimeLimit = this.getDefaultWalltime(queueDefault);\n      if (this.maxPhysicalMemory === 0) {\n        this.data.totalPhysicalMemory = 0;\n      }\n    },\n    validate() {\n      if (!this.valid) {\n        this.$emit(\"invalid\");\n      } else {\n        this.$emit(\"valid\");\n      }\n    },\n    loadAppDeploymentQueues() {\n      return services.ApplicationDeploymentService.getQueues({\n        lookup: this.appDeploymentId,\n      }).then((queueDefaults) => (this.appDeploymentQueues = queueDefaults));\n    },\n    setDefaultQueue() {\n      if (this.queueDefaults.length === 0) {\n        this.data.queueName = null;\n        return;\n      }\n      const defaultQueue = this.queueDefaults[0];\n\n      this.data.queueName = defaultQueue.queueName;\n      this.data.totalCPUCount = this.getDefaultCPUCount(defaultQueue);\n      this.data.nodeCount = this.getDefaultNodeCount(defaultQueue);\n      this.data.wallTimeLimit = this.getDefaultWalltime(defaultQueue);\n      if (this.maxPhysicalMemory === 0) {\n        this.data.totalPhysicalMemory = 0;\n      }\n    },\n    isQueueInComputeResourcePolicy: function (queueName) {\n      if (!this.computeResourcePolicy) {\n        return true;\n      }\n      return this.computeResourcePolicy.allowedBatchQueues.includes(queueName);\n    },\n    getBatchQueueResourcePolicy: function (queueName) {\n      if (\n        !this.batchQueueResourcePolicies ||\n        this.batchQueueResourcePolicies.length === 0\n      ) {\n        return null;\n      }\n      return this.batchQueueResourcePolicies.find(\n        (bqrp) => bqrp.queuename === queueName\n      );\n    },\n    getDefaultCPUCount: function (queueDefault) {\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedCores,\n          queueDefault.defaultCPUCount\n        );\n      }\n      return queueDefault.defaultCPUCount;\n    },\n    getDefaultNodeCount: function (queueDefault) {\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedNodes,\n          queueDefault.defaultNodeCount\n        );\n      }\n      return queueDefault.defaultNodeCount;\n    },\n    getDefaultWalltime: function (queueDefault) {\n      const batchQueueResourcePolicy = this.batchQueueResourcePolicy;\n      if (batchQueueResourcePolicy) {\n        return Math.min(\n          batchQueueResourcePolicy.maxAllowedWalltime,\n          queueDefault.defaultWalltime\n        );\n      }\n      return queueDefault.defaultWalltime;\n    },\n    getValidationFeedback: function (properties) {\n      return utils.getProperty(this.validation, properties);\n    },\n    getValidationState: function (properties, showValidState) {\n      return this.getValidationFeedback(properties)\n        ? \"invalid\"\n        : showValidState\n        ? \"valid\"\n        : null;\n    },\n    applyBatchQueueResourcePolicy() {\n      // Apply batchQueueResourcePolicy maximums\n      if (this.selectedQueueDefault) {\n        this.data.totalCPUCount = Math.min(\n          this.data.totalCPUCount,\n          this.maxCPUCount\n        );\n        this.data.nodeCount = Math.min(this.data.nodeCount, this.maxNodes);\n        this.data.wallTimeLimit = Math.min(\n          this.data.wallTimeLimit,\n          this.maxWalltime\n        );\n      }\n    },\n  },\n  watch: {\n    appDeploymentId() {\n      this.loadAppDeploymentQueues().then(() => this.setDefaultQueue());\n    },\n    // If batch queue policy changes, apply any maximum values to current values\n    batchQueueResourcePolicy(value, oldValue) {\n      if (\n        value &&\n        (!oldValue || value.resourcePolicyId !== oldValue.resourcePolicyId)\n      ) {\n        this.applyBatchQueueResourcePolicy();\n      }\n    },\n    computeResourcePolicy() {\n      if (!this.isQueueInComputeResourcePolicy(this.data.queueName)) {\n        this.setDefaultQueue();\n      }\n    },\n  },\n  mounted: function () {\n    this.loadAppDeploymentQueues().then(() => {\n      // For brand new queue settings (no queueName specified) load the default\n      // queue and its default values and apply them\n      if (!this.value.queueName) {\n        this.setDefaultQueue();\n      }\n    });\n    this.$on(\"input\", () => this.validate());\n  },\n};\n</script>\n\n<style></style>\n"],"sourceRoot":"static/django_airavata_workspace/js/components/experiment"}]}