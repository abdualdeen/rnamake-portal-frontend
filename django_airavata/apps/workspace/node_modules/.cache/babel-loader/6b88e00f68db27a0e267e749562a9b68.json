{"remainingRequest":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/thread-loader/dist/cjs.js!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/babel-loader/lib/index.js!/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--13-0!/home/vanishing/git/airavata-django-portal/django_airavata/apps/api/static/django_airavata_api/js/services/ServiceFactory.js","dependencies":[{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/api/static/django_airavata_api/js/services/ServiceFactory.js","mtime":1638641844323},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1638646228487},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/thread-loader/dist/cjs.js","mtime":1638646228889},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/babel-loader/lib/index.js","mtime":1638646225600},{"path":"/home/vanishing/git/airavata-django-portal/django_airavata/apps/workspace/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1638646227499}],"contextDependencies":[],"result":["import \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.regexp.constructor\";\nimport PaginationIterator from \"../utils/PaginationIterator\";\nimport FetchUtils from \"../utils/FetchUtils\";\nimport serviceConfiguration from \"../service_config\";\nvar postKey = \"post\";\nvar getKey = \"get\";\nvar putKey = \"put\";\nvar delKey = \"delete\";\n\nvar parsePathParams = function parsePathParams(url) {\n  var pathParamsRegEx = new RegExp(\"<[a-zA-Z0-9_]+(:[a-zA-Z0-9_]*)?>\", \"g\");\n  var pathParamsMatch = url.match(pathParamsRegEx);\n  var pathParams = {};\n\n  if (!pathParamsMatch) {\n    return pathParams;\n  }\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = pathParamsMatch[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var pathParamMatch = _step.value;\n      var pathParam = pathParamMatch.split(\":\");\n\n      if (pathParam.length == 2) {\n        pathParams[pathParam[1]] = pathParam[0].replace(/<|>/gi, \"\");\n      } else {\n        pathParams[pathParam[0].replace(/<|>/gi, \"\")] = null;\n      }\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return pathParams;\n};\n\nvar parseServiceMapping = function parseServiceMapping(serviceConfiguration) {\n  var mappedFunctions = {};\n  var viewSetFunctions = [];\n\n  if (serviceConfiguration.viewSet === true) {\n    viewSetFunctions = [\"list\", \"create\", \"update\", \"delete\", \"retrieve\"];\n  } else if (serviceConfiguration.viewSet instanceof Array) {\n    viewSetFunctions = serviceConfiguration.viewSet;\n  }\n\n  var url = serviceConfiguration.url;\n\n  if (!url.endsWith(\"/\")) {\n    url = url + \"/\";\n  }\n\n  var modelClass = serviceConfiguration.modelClass;\n  var queryParams = serviceConfiguration.queryParams;\n  var defaultPagination = serviceConfiguration.pagination ? true : false;\n  var encodePathParams = \"encodePathParams\" in serviceConfiguration ? serviceConfiguration.encodePathParams : true;\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = viewSetFunctions[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var viewSetFunction = _step2.value;\n      var viewSetFunctionName = viewSetFunction;\n      var pagination = defaultPagination;\n\n      if (typeof viewSetFunctionName !== \"string\") {\n        viewSetFunctionName = viewSetFunction.name;\n\n        if (\"pagination\" in viewSetFunction) {\n          pagination = viewSetFunction.pagination;\n        }\n      }\n\n      switch (viewSetFunctionName) {\n        case \"list\":\n          mappedFunctions[\"list\"] = {\n            url: url,\n            requestType: getKey,\n            modelClass: modelClass,\n            queryParams: queryParams,\n            initialDataParam: viewSetFunction.initialDataParam,\n            encodePathParams: encodePathParams\n          };\n          break;\n\n        case \"create\":\n          mappedFunctions[\"create\"] = {\n            url: url,\n            requestType: postKey,\n            bodyParams: {\n              name: \"data\"\n            },\n            modelClass: modelClass,\n            queryParams: queryParams,\n            encodePathParams: encodePathParams\n          };\n          break;\n\n        case \"update\":\n          mappedFunctions[\"update\"] = {\n            url: url + \"<lookup>/\",\n            requestType: putKey,\n            bodyParams: {\n              name: \"data\"\n            },\n            modelClass: modelClass,\n            queryParams: queryParams,\n            encodePathParams: encodePathParams\n          };\n          break;\n\n        case \"retrieve\":\n          mappedFunctions[\"retrieve\"] = {\n            url: url + \"<lookup>/\",\n            requestType: getKey,\n            modelClass: modelClass,\n            queryParams: queryParams,\n            initialDataParam: viewSetFunction.initialDataParam,\n            encodePathParams: encodePathParams\n          };\n          break;\n\n        case \"delete\":\n          mappedFunctions[\"delete\"] = {\n            url: url + \"<lookup>/\",\n            requestType: delKey,\n            modelClass: modelClass,\n            queryParams: queryParams,\n            encodePathParams: encodePathParams\n          };\n          break;\n\n        default:\n          // Assume all fields have been provided\n          mappedFunctions[viewSetFunctionName] = viewSetFunction;\n          break;\n      }\n\n      mappedFunctions[viewSetFunctionName].pagination = pagination;\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  if (\"methods\" in serviceConfiguration) {\n    for (var _i = 0, _Object$keys = Object.keys(serviceConfiguration[\"methods\"]); _i < _Object$keys.length; _i++) {\n      var methodName = _Object$keys[_i];\n      var methodConfig = serviceConfiguration[\"methods\"][methodName];\n      mappedFunctions[methodName] = {\n        url: methodConfig.url || url,\n        requestType: methodConfig.requestType || getKey,\n        queryParams: methodConfig.queryParams || queryParams,\n        pagination: \"pagination\" in methodConfig ? methodConfig.pagination : defaultPagination,\n        encodePathParams: \"encodePathParams\" in methodConfig ? methodConfig.encodePathParams : true\n      };\n\n      if (\"modelClass\" in methodConfig) {\n        mappedFunctions[methodName][\"modelClass\"] = methodConfig.modelClass;\n      }\n\n      if (\"bodyParams\" in methodConfig) {\n        mappedFunctions[methodName][\"bodyParams\"] = methodConfig.bodyParams;\n      }\n\n      if (\"pathParams\" in methodConfig) {\n        mappedFunctions[methodName][\"pathParams\"] = methodConfig.pathParams;\n      }\n    }\n  }\n\n  return mappedFunctions;\n};\n\nvar parseQueryMapping = function parseQueryMapping(queryParamsMapping) {\n  var newQueryParamMapping = {};\n\n  if (!queryParamsMapping) {\n    return newQueryParamMapping;\n  } // names of query parameters as an array of strings\n\n\n  if (queryParamsMapping instanceof Array) {\n    var _iteratorNormalCompletion3 = true;\n    var _didIteratorError3 = false;\n    var _iteratorError3 = undefined;\n\n    try {\n      for (var _iterator3 = queryParamsMapping[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n        var queryParam = _step3.value;\n\n        if (typeof queryParam === \"string\") {\n          newQueryParamMapping[queryParam] = null;\n        }\n      }\n    } catch (err) {\n      _didIteratorError3 = true;\n      _iteratorError3 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n          _iterator3.return();\n        }\n      } finally {\n        if (_didIteratorError3) {\n          throw _iteratorError3;\n        }\n      }\n    }\n  } // mapping of query parameters as an object of names/values\n  else {\n      for (var _i2 = 0, _Object$keys2 = Object.keys(queryParamsMapping); _i2 < _Object$keys2.length; _i2++) {\n        var _queryParam = _Object$keys2[_i2];\n        newQueryParamMapping[_queryParam] = queryParamsMapping[_queryParam];\n      }\n    }\n\n  return newQueryParamMapping;\n};\n\nclass ServiceFactory {\n  constructor(serviceConfigurations) {\n    var parsedConfigurations = {};\n\n    for (var _i3 = 0, _Object$keys3 = Object.keys(serviceConfigurations); _i3 < _Object$keys3.length; _i3++) {\n      var serviceName = _Object$keys3[_i3];\n      parsedConfigurations[serviceName] = parseServiceMapping(serviceConfigurations[serviceName]);\n    }\n\n    this.serviceConfigurations = parsedConfigurations;\n  }\n  /*\n    Creates service object based serviceName in service configuration\n     */\n\n\n  service(serviceName) {\n    if (!serviceName) {\n      throw new TypeError(\"Invalid Service Name\");\n    } else if (!(serviceName in this.serviceConfigurations)) {\n      throw new Error(\"Service :\" + serviceName + \" could not be found\");\n    }\n\n    var serviceConfiguration = this.serviceConfigurations[serviceName];\n    var serviceObj = {};\n    var functionNames = Object.keys(serviceConfiguration);\n\n    var _loop = function _loop() {\n      var functionName = _functionNames[_i4];\n      var config = serviceConfiguration[functionName];\n\n      switch (config.requestType.toLowerCase()) {\n        case postKey:\n        case getKey:\n        case putKey:\n        case delKey:\n          break;\n\n        default:\n          throw new TypeError(\"Invalid request type: \" + config.requestType + \" for the function: \" + functionName + \" in the service: \" + serviceName);\n      }\n\n      var pathParamsMapping = parsePathParams(config.url);\n      var queryParamsMapping = parseQueryMapping(config.queryParams);\n\n      serviceObj[functionName] = function () {\n        var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n        var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n          ignoreErrors: false,\n          showSpinner: true,\n          cache: false\n        },\n            ignoreErrors = _ref.ignoreErrors,\n            showSpinner = _ref.showSpinner,\n            cache = _ref.cache;\n\n        var url = config.url;\n        var paramKeys = Object.keys(params);\n        var queryParams = {};\n        var bodyParams = {};\n        var initialData = undefined;\n\n        for (var _i5 = 0, _paramKeys = paramKeys; _i5 < _paramKeys.length; _i5++) {\n          var paramKey = _paramKeys[_i5];\n\n          if (paramKey in pathParamsMapping) {\n            if (pathParamsMapping[paramKey] !== null) {\n              url = url.replace(\"<\" + pathParamsMapping[paramKey] + \":\" + paramKey + \">\", config.encodePathParams ? encodeURIComponent(params[paramKey]) : params[paramKey]);\n            } else {\n              url = url.replace(\"<\" + paramKey + \">\", config.encodePathParams ? encodeURIComponent(params[paramKey]) : params[paramKey]);\n            }\n          } else if (paramKey in queryParamsMapping) {\n            if (queryParamsMapping[paramKey] === null) {\n              queryParams[paramKey] = params[paramKey];\n            } else {\n              queryParams[queryParamsMapping[paramKey]] = params[paramKey];\n            }\n          } else if ((config.requestType == postKey || config.requestType == putKey) && config.bodyParams instanceof Array && paramKey in config.bodyParams) {\n            bodyParams[paramKey] = params[paramKey];\n          } else if ((config.requestType == postKey || config.requestType == putKey) && config.bodyParams !== null && config.bodyParams.name == paramKey) {\n            bodyParams = params[paramKey];\n          } else if (config.initialDataParam && paramKey === config.initialDataParam) {\n            initialData = params[paramKey];\n          }\n        }\n\n        var paginationHandler = data => {\n          if (config.pagination === true && \"next\" in data) {\n            return new PaginationIterator(data, config.modelClass);\n          } else if (data instanceof Array) {\n            return data.map(item => resultHandler(item));\n          } else {\n            return resultHandler(data);\n          }\n        };\n\n        var resultHandler = data => {\n          return config.modelClass ? new config.modelClass(data) : data;\n        };\n\n        switch (config.requestType.toLowerCase()) {\n          case postKey:\n            return FetchUtils.post(url, bodyParams, queryParams, {\n              ignoreErrors,\n              showSpinner\n            }).then(resultHandler);\n\n          case getKey:\n            if (initialData) {\n              return Promise.resolve(paginationHandler(initialData));\n            } else {\n              return FetchUtils.get(url, queryParams, {\n                ignoreErrors,\n                showSpinner,\n                cache\n              }).then(paginationHandler);\n            }\n\n          case putKey:\n            return FetchUtils.put(url, bodyParams, {\n              ignoreErrors,\n              showSpinner\n            }).then(resultHandler);\n\n          case delKey:\n            return FetchUtils.delete(url, {\n              ignoreErrors,\n              showSpinner\n            });\n        }\n      };\n    };\n\n    for (var _i4 = 0, _functionNames = functionNames; _i4 < _functionNames.length; _i4++) {\n      _loop();\n    }\n\n    return serviceObj;\n  }\n\n}\n\nexport default new ServiceFactory(serviceConfiguration);",{"version":3,"sources":["/home/vanishing/git/airavata-django-portal/django_airavata/apps/api/static/django_airavata_api/js/services/ServiceFactory.js"],"names":["PaginationIterator","FetchUtils","serviceConfiguration","postKey","getKey","putKey","delKey","parsePathParams","url","pathParamsRegEx","RegExp","pathParamsMatch","match","pathParams","pathParamMatch","pathParam","split","length","replace","parseServiceMapping","mappedFunctions","viewSetFunctions","viewSet","Array","endsWith","modelClass","queryParams","defaultPagination","pagination","encodePathParams","viewSetFunction","viewSetFunctionName","name","requestType","initialDataParam","bodyParams","Object","keys","methodName","methodConfig","parseQueryMapping","queryParamsMapping","newQueryParamMapping","queryParam","ServiceFactory","constructor","serviceConfigurations","parsedConfigurations","serviceName","service","TypeError","Error","serviceObj","functionNames","functionName","config","toLowerCase","pathParamsMapping","params","ignoreErrors","showSpinner","cache","paramKeys","initialData","undefined","paramKey","encodeURIComponent","paginationHandler","data","map","item","resultHandler","post","then","Promise","resolve","get","put","delete"],"mappings":"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","sourcesContent":["import PaginationIterator from \"../utils/PaginationIterator\";\nimport FetchUtils from \"../utils/FetchUtils\";\nimport serviceConfiguration from \"../service_config\";\n\nconst postKey = \"post\";\nconst getKey = \"get\";\nconst putKey = \"put\";\nconst delKey = \"delete\";\n\nconst parsePathParams = function (url) {\n  var pathParamsRegEx = new RegExp(\"<[a-zA-Z0-9_]+(:[a-zA-Z0-9_]*)?>\", \"g\");\n  let pathParamsMatch = url.match(pathParamsRegEx);\n  let pathParams = {};\n  if (!pathParamsMatch) {\n    return pathParams;\n  }\n  for (let pathParamMatch of pathParamsMatch) {\n    let pathParam = pathParamMatch.split(\":\");\n    if (pathParam.length == 2) {\n      pathParams[pathParam[1]] = pathParam[0].replace(/<|>/gi, \"\");\n    } else {\n      pathParams[pathParam[0].replace(/<|>/gi, \"\")] = null;\n    }\n  }\n  return pathParams;\n};\n\nconst parseServiceMapping = function (serviceConfiguration) {\n  const mappedFunctions = {};\n  let viewSetFunctions = [];\n  if (serviceConfiguration.viewSet === true) {\n    viewSetFunctions = [\"list\", \"create\", \"update\", \"delete\", \"retrieve\"];\n  } else if (serviceConfiguration.viewSet instanceof Array) {\n    viewSetFunctions = serviceConfiguration.viewSet;\n  }\n  let url = serviceConfiguration.url;\n  if (!url.endsWith(\"/\")) {\n    url = url + \"/\";\n  }\n  let modelClass = serviceConfiguration.modelClass;\n  let queryParams = serviceConfiguration.queryParams;\n  let defaultPagination = serviceConfiguration.pagination ? true : false;\n  let encodePathParams =\n    \"encodePathParams\" in serviceConfiguration\n      ? serviceConfiguration.encodePathParams\n      : true;\n  for (let viewSetFunction of viewSetFunctions) {\n    let viewSetFunctionName = viewSetFunction;\n    let pagination = defaultPagination;\n    if (typeof viewSetFunctionName !== \"string\") {\n      viewSetFunctionName = viewSetFunction.name;\n      if (\"pagination\" in viewSetFunction) {\n        pagination = viewSetFunction.pagination;\n      }\n    }\n    switch (viewSetFunctionName) {\n      case \"list\":\n        mappedFunctions[\"list\"] = {\n          url: url,\n          requestType: getKey,\n          modelClass: modelClass,\n          queryParams: queryParams,\n          initialDataParam: viewSetFunction.initialDataParam,\n          encodePathParams: encodePathParams,\n        };\n        break;\n      case \"create\":\n        mappedFunctions[\"create\"] = {\n          url: url,\n          requestType: postKey,\n          bodyParams: {\n            name: \"data\",\n          },\n          modelClass: modelClass,\n          queryParams: queryParams,\n          encodePathParams: encodePathParams,\n        };\n        break;\n      case \"update\":\n        mappedFunctions[\"update\"] = {\n          url: url + \"<lookup>/\",\n          requestType: putKey,\n          bodyParams: {\n            name: \"data\",\n          },\n          modelClass: modelClass,\n          queryParams: queryParams,\n          encodePathParams: encodePathParams,\n        };\n        break;\n      case \"retrieve\":\n        mappedFunctions[\"retrieve\"] = {\n          url: url + \"<lookup>/\",\n          requestType: getKey,\n          modelClass: modelClass,\n          queryParams: queryParams,\n          initialDataParam: viewSetFunction.initialDataParam,\n          encodePathParams: encodePathParams,\n        };\n        break;\n      case \"delete\":\n        mappedFunctions[\"delete\"] = {\n          url: url + \"<lookup>/\",\n          requestType: delKey,\n          modelClass: modelClass,\n          queryParams: queryParams,\n          encodePathParams: encodePathParams,\n        };\n        break;\n      default:\n        // Assume all fields have been provided\n        mappedFunctions[viewSetFunctionName] = viewSetFunction;\n        break;\n    }\n    mappedFunctions[viewSetFunctionName].pagination = pagination;\n  }\n  if (\"methods\" in serviceConfiguration) {\n    for (let methodName of Object.keys(serviceConfiguration[\"methods\"])) {\n      let methodConfig = serviceConfiguration[\"methods\"][methodName];\n      mappedFunctions[methodName] = {\n        url: methodConfig.url || url,\n        requestType: methodConfig.requestType || getKey,\n        queryParams: methodConfig.queryParams || queryParams,\n        pagination:\n          \"pagination\" in methodConfig\n            ? methodConfig.pagination\n            : defaultPagination,\n        encodePathParams:\n          \"encodePathParams\" in methodConfig\n            ? methodConfig.encodePathParams\n            : true,\n      };\n      if (\"modelClass\" in methodConfig) {\n        mappedFunctions[methodName][\"modelClass\"] = methodConfig.modelClass;\n      }\n      if (\"bodyParams\" in methodConfig) {\n        mappedFunctions[methodName][\"bodyParams\"] = methodConfig.bodyParams;\n      }\n      if (\"pathParams\" in methodConfig) {\n        mappedFunctions[methodName][\"pathParams\"] = methodConfig.pathParams;\n      }\n    }\n  }\n  return mappedFunctions;\n};\n\nconst parseQueryMapping = function (queryParamsMapping) {\n  let newQueryParamMapping = {};\n  if (!queryParamsMapping) {\n    return newQueryParamMapping;\n  }\n  // names of query parameters as an array of strings\n  if (queryParamsMapping instanceof Array) {\n    for (let queryParam of queryParamsMapping) {\n      if (typeof queryParam === \"string\") {\n        newQueryParamMapping[queryParam] = null;\n      }\n    }\n  }\n  // mapping of query parameters as an object of names/values\n  else {\n    for (let queryParam of Object.keys(queryParamsMapping)) {\n      newQueryParamMapping[queryParam] = queryParamsMapping[queryParam];\n    }\n  }\n  return newQueryParamMapping;\n};\n\nclass ServiceFactory {\n  constructor(serviceConfigurations) {\n    const parsedConfigurations = {};\n    for (let serviceName of Object.keys(serviceConfigurations)) {\n      parsedConfigurations[serviceName] = parseServiceMapping(\n        serviceConfigurations[serviceName]\n      );\n    }\n    this.serviceConfigurations = parsedConfigurations;\n  }\n\n  /*\n    Creates service object based serviceName in service configuration\n     */\n  service(serviceName) {\n    if (!serviceName) {\n      throw new TypeError(\"Invalid Service Name\");\n    } else if (!(serviceName in this.serviceConfigurations)) {\n      throw new Error(\"Service :\" + serviceName + \" could not be found\");\n    }\n    let serviceConfiguration = this.serviceConfigurations[serviceName];\n    let serviceObj = {};\n    let functionNames = Object.keys(serviceConfiguration);\n    for (let functionName of functionNames) {\n      let config = serviceConfiguration[functionName];\n      switch (config.requestType.toLowerCase()) {\n        case postKey:\n        case getKey:\n        case putKey:\n        case delKey:\n          break;\n        default:\n          throw new TypeError(\n            \"Invalid request type: \" +\n              config.requestType +\n              \" for the function: \" +\n              functionName +\n              \" in the service: \" +\n              serviceName\n          );\n      }\n      let pathParamsMapping = parsePathParams(config.url);\n      let queryParamsMapping = parseQueryMapping(config.queryParams);\n      serviceObj[functionName] = function (\n        params = {},\n        { ignoreErrors, showSpinner, cache } = {\n          ignoreErrors: false,\n          showSpinner: true,\n          cache: false,\n        }\n      ) {\n        let url = config.url;\n        let paramKeys = Object.keys(params);\n        let queryParams = {};\n        let bodyParams = {};\n        let initialData = undefined;\n        for (let paramKey of paramKeys) {\n          if (paramKey in pathParamsMapping) {\n            if (pathParamsMapping[paramKey] !== null) {\n              url = url.replace(\n                \"<\" + pathParamsMapping[paramKey] + \":\" + paramKey + \">\",\n                config.encodePathParams\n                  ? encodeURIComponent(params[paramKey])\n                  : params[paramKey]\n              );\n            } else {\n              url = url.replace(\n                \"<\" + paramKey + \">\",\n                config.encodePathParams\n                  ? encodeURIComponent(params[paramKey])\n                  : params[paramKey]\n              );\n            }\n          } else if (paramKey in queryParamsMapping) {\n            if (queryParamsMapping[paramKey] === null) {\n              queryParams[paramKey] = params[paramKey];\n            } else {\n              queryParams[queryParamsMapping[paramKey]] = params[paramKey];\n            }\n          } else if (\n            (config.requestType == postKey || config.requestType == putKey) &&\n            config.bodyParams instanceof Array &&\n            paramKey in config.bodyParams\n          ) {\n            bodyParams[paramKey] = params[paramKey];\n          } else if (\n            (config.requestType == postKey || config.requestType == putKey) &&\n            config.bodyParams !== null &&\n            config.bodyParams.name == paramKey\n          ) {\n            bodyParams = params[paramKey];\n          } else if (\n            config.initialDataParam &&\n            paramKey === config.initialDataParam\n          ) {\n            initialData = params[paramKey];\n          }\n        }\n        let paginationHandler = (data) => {\n          if (config.pagination === true && \"next\" in data) {\n            return new PaginationIterator(data, config.modelClass);\n          } else if (data instanceof Array) {\n            return data.map((item) => resultHandler(item));\n          } else {\n            return resultHandler(data);\n          }\n        };\n        let resultHandler = (data) => {\n          return config.modelClass ? new config.modelClass(data) : data;\n        };\n        switch (config.requestType.toLowerCase()) {\n          case postKey:\n            return FetchUtils.post(url, bodyParams, queryParams, {\n              ignoreErrors,\n              showSpinner,\n            }).then(resultHandler);\n          case getKey:\n            if (initialData) {\n              return Promise.resolve(paginationHandler(initialData));\n            } else {\n              return FetchUtils.get(url, queryParams, {\n                ignoreErrors,\n                showSpinner,\n                cache,\n              }).then(paginationHandler);\n            }\n          case putKey:\n            return FetchUtils.put(url, bodyParams, {\n              ignoreErrors,\n              showSpinner,\n            }).then(resultHandler);\n          case delKey:\n            return FetchUtils.delete(url, { ignoreErrors, showSpinner });\n        }\n      };\n    }\n    return serviceObj;\n  }\n}\n\nexport default new ServiceFactory(serviceConfiguration);\n"]}]}